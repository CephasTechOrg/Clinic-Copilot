<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provider Dashboard - Clinic Co-Pilot</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300&display=swap" rel="stylesheet" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
              accent: { 500: '#8b5cf6', 600: '#7c3aed' },
            },
            fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out',
              'slide-up': 'slideUp 0.4s ease-out',
              'spin-slow': 'spin 2s linear infinite',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
            }
          }
        }
      }
    </script>
    <style>
      body { font-family: 'Inter', sans-serif; }
      .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
      .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .gradient-teal { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); }
      .card-hover { transition: all 0.3s ease; }
      .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 40px -12px rgba(0,0,0,0.15); }
      input { 
        border-radius: 12px; 
        border: 1.5px solid #e2e8f0; 
        padding: 14px 16px;
        transition: all 0.2s ease;
        font-size: 18px;
        font-weight: 500;
      }
      input:focus {
        border-color: #14b8a6;
        outline: none;
        box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15);
      }
      .patient-card { transition: all 0.2s ease; }
      .patient-card:hover { background: #f8fafc; }
      .patient-card.selected { background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); border-color: #14b8a6; }
      .priority-high { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-color: #fca5a5; }
      .priority-med { background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-color: #fcd34d; }
      .priority-low { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-color: #86efac; }
      @keyframes pulse-ring {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.5); opacity: 0; }
      }
      .pulse-ring::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 50%;
        border: 2px solid currentColor;
        animation: pulse-ring 1.5s ease-out infinite;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-slate-50 via-teal-50/20 to-emerald-50/20 text-slate-900 min-h-screen">
    <!-- Decorative Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-96 h-96 bg-teal-200/20 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-emerald-200/20 rounded-full blur-3xl"></div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 glass border-b border-white/30">
      <div class="max-w-6xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg gradient-teal flex items-center justify-center shadow-md">
              <span class="material-symbols-outlined text-white text-lg">vital_signs</span>
            </div>
            <h1 class="text-base font-bold bg-gradient-to-r from-teal-600 to-emerald-600 bg-clip-text text-transparent">Clinic Co-Pilot</h1>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-1.5">
              <span class="text-xs text-slate-400">Step 2/3</span>
              <div class="flex gap-0.5">
                <div class="w-6 h-1 rounded-full bg-teal-500"></div>
                <div class="w-6 h-1 rounded-full bg-teal-500"></div>
                <div class="w-6 h-1 rounded-full bg-slate-200"></div>
              </div>
            </div>
            <div class="hidden md:flex items-center gap-1.5 px-2 py-1 bg-emerald-100 rounded-full">
              <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
              <span class="text-xs font-semibold text-emerald-700">Online</span>
            </div>
            <!-- User Info & Logout -->
            <div class="flex items-center gap-2 ml-2 pl-2 border-l border-slate-200">
              <div class="flex items-center gap-1.5">
                <span class="material-symbols-outlined text-teal-600 text-lg">person</span>
                <span id="user-name" class="text-xs font-medium text-slate-600"></span>
              </div>
              <button onclick="AUTH.logout()" class="flex items-center gap-1 px-2 py-1 text-xs font-medium text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                <span class="material-symbols-outlined text-sm">logout</span>
                <span class="hidden sm:inline">Logout</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="relative max-w-6xl mx-auto px-4 py-6">
      <div class="grid gap-6 lg:grid-cols-[380px_1fr]">
        <!-- Patient Queue Panel -->
        <section class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-bold text-slate-800">Patient Queue</h2>
              <p class="text-sm text-slate-500" id="queue-subtitle">Loading...</p>
            </div>
            <button onclick="location.reload()" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" title="Refresh">
              <span class="material-symbols-outlined text-slate-500">refresh</span>
            </button>
          </div>

          <div class="space-y-3" id="queue-list">
            <!-- Patient cards will be inserted here -->
          </div>

          <div class="hidden text-center py-8" id="queue-empty">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center">
              <span class="material-symbols-outlined text-slate-400 text-3xl">hourglass_empty</span>
            </div>
            <p class="text-slate-500 font-medium">No patients in queue</p>
            <p class="text-sm text-slate-400">New patients will appear here</p>
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-2 gap-3 pt-4">
            <div class="bg-white/70 backdrop-blur-sm rounded-xl border border-white/50 p-4 text-center">
              <p class="text-2xl font-bold text-teal-600" id="stat-waiting">0</p>
              <p class="text-xs text-slate-500 font-medium">Awaiting Vitals</p>
            </div>
            <div class="bg-white/70 backdrop-blur-sm rounded-xl border border-white/50 p-4 text-center">
              <p class="text-2xl font-bold text-emerald-600" id="stat-completed">0</p>
              <p class="text-xs text-slate-500 font-medium">Completed Today</p>
            </div>
          </div>
        </section>

        <!-- Vitals Entry Panel -->
        <section class="bg-white/80 backdrop-blur-sm rounded-2xl border border-white/50 shadow-xl shadow-slate-200/30 overflow-hidden">
          <div class="bg-gradient-to-r from-teal-500 to-emerald-500 px-6 py-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                <span class="material-symbols-outlined text-white">monitoring</span>
              </div>
              <div>
                <h2 class="font-semibold text-white">Vitals Entry</h2>
                <p class="text-sm text-teal-100" id="vitals-patient-label">Select a patient from the queue</p>
              </div>
            </div>
          </div>

          <form id="vitals-form" class="p-6 space-y-6">
            <!-- Vital Signs Grid -->
            <div class="grid gap-5 md:grid-cols-2">
              <!-- Heart Rate -->
              <div class="space-y-2">
                <label class="flex items-center justify-between">
                  <span class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-red-100 flex items-center justify-center">
                      <span class="material-symbols-outlined text-red-500 text-lg">favorite</span>
                    </span>
                    Heart Rate
                  </span>
                  <span class="text-xs text-slate-400 font-medium">bpm</span>
                </label>
                <input name="heart_rate" required type="number" placeholder="72" min="30" max="250" class="w-full text-center" />
                <p class="text-xs text-slate-400 text-center">Normal: 60-100 bpm</p>
              </div>

              <!-- Respiratory Rate -->
              <div class="space-y-2">
                <label class="flex items-center justify-between">
                  <span class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
                      <span class="material-symbols-outlined text-blue-500 text-lg">pulmonology</span>
                    </span>
                    Respiratory Rate
                  </span>
                  <span class="text-xs text-slate-400 font-medium">/min</span>
                </label>
                <input name="respiratory_rate" required type="number" placeholder="16" min="8" max="60" class="w-full text-center" />
                <p class="text-xs text-slate-400 text-center">Normal: 12-20 /min</p>
              </div>

              <!-- Temperature -->
              <div class="space-y-2">
                <label class="flex items-center justify-between">
                  <span class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center">
                      <span class="material-symbols-outlined text-amber-500 text-lg">thermostat</span>
                    </span>
                    Temperature
                  </span>
                  <span class="text-xs text-slate-400 font-medium">°C</span>
                </label>
                <input name="temperature_c" required type="number" step="0.1" placeholder="36.6" min="32" max="43" class="w-full text-center" />
                <p class="text-xs text-slate-400 text-center">Normal: 36.1-37.2 °C</p>
              </div>

              <!-- SpO2 -->
              <div class="space-y-2">
                <label class="flex items-center justify-between">
                  <span class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center">
                      <span class="material-symbols-outlined text-purple-500 text-lg">spo2</span>
                    </span>
                    Oxygen Saturation
                  </span>
                  <span class="text-xs text-slate-400 font-medium">%</span>
                </label>
                <input name="spo2" required type="number" placeholder="98" min="70" max="100" class="w-full text-center" />
                <p class="text-xs text-slate-400 text-center">Normal: 95-100%</p>
              </div>

              <!-- Blood Pressure -->
              <div class="md:col-span-2 space-y-2">
                <label class="flex items-center gap-2">
                  <span class="w-8 h-8 rounded-lg bg-teal-100 flex items-center justify-center">
                    <span class="material-symbols-outlined text-teal-500 text-lg">bloodtype</span>
                  </span>
                  <span class="text-sm font-semibold text-slate-700">Blood Pressure</span>
                </label>
                <div class="grid grid-cols-2 gap-4">
                  <div class="relative">
                    <input name="systolic_bp" required type="number" placeholder="120" min="60" max="250" class="w-full text-center pr-12" />
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-semibold text-slate-400">SYS</span>
                  </div>
                  <div class="relative">
                    <input name="diastolic_bp" required type="number" placeholder="80" min="40" max="150" class="w-full text-center pr-12" />
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-semibold text-slate-400">DIA</span>
                  </div>
                </div>
                <p class="text-xs text-slate-400 text-center">Normal: 90-120 / 60-80 mmHg</p>
              </div>
            </div>

            <!-- AI Notice -->
            <div class="flex items-start gap-3 p-4 bg-gradient-to-r from-primary-50 to-accent-50 border border-primary-100 rounded-xl">
              <span class="material-symbols-outlined text-primary-500 text-xl mt-0.5">auto_awesome</span>
              <div>
                <p class="text-sm font-semibold text-primary-700">AI-Powered Analysis</p>
                <p class="text-xs text-primary-600">After saving vitals, our AI will generate a clinical summary with priority assessment and red flags.</p>
              </div>
            </div>

            <!-- Actions -->
            <div class="space-y-3 pt-2">
              <div class="text-center text-sm text-red-500 font-medium hidden" id="vitals-error"></div>
              
              <button type="submit" id="save-vitals" class="w-full gradient-teal text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-teal-500/30 hover:shadow-xl hover:shadow-teal-500/40 hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                <span class="material-symbols-outlined">send</span>
                <span>Forward to Doctor</span>
              </button>
              
              <a href="/patient" class="block text-center text-sm text-slate-500 hover:text-slate-700 font-medium py-2 transition-colors">
                ← Back to Patient Intake
              </a>
            </div>
          </form>
        </section>
      </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 transform translate-x-[120%] transition-transform duration-300 z-[100]">
      <div class="bg-white rounded-xl shadow-2xl border border-slate-100 p-4 flex items-center gap-3 min-w-[300px]">
        <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0" id="toast-icon-wrapper">
          <span class="material-symbols-outlined" id="toast-icon">check_circle</span>
        </div>
        <div>
          <p class="font-semibold text-slate-800" id="toast-title">Success</p>
          <p class="text-sm text-slate-500" id="toast-message">Operation completed</p>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[200] hidden flex items-center justify-center">
      <div class="bg-white rounded-2xl p-8 shadow-2xl text-center max-w-sm mx-4">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-teal-500 to-emerald-500 flex items-center justify-center animate-pulse">
          <span class="material-symbols-outlined text-white text-3xl animate-spin-slow">autorenew</span>
        </div>
        <h3 class="font-bold text-lg text-slate-800 mb-2">Generating AI Summary</h3>
        <p class="text-sm text-slate-500">Analyzing vitals and patient data...</p>
        <div class="mt-4 h-1.5 bg-slate-100 rounded-full overflow-hidden">
          <div class="h-full bg-gradient-to-r from-teal-500 to-emerald-500 rounded-full animate-pulse" style="width: 70%"></div>
        </div>
      </div>
    </div>

    <script>
      // Toast function (must be defined before nurse.js loads)
      window.showToast = function(title, message, isError = false) {
        const toast = document.getElementById('toast');
        const toastTitle = document.getElementById('toast-title');
        const toastMessage = document.getElementById('toast-message');
        const toastIcon = document.getElementById('toast-icon');
        const toastIconWrapper = document.getElementById('toast-icon-wrapper');
        
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        
        if (isError) {
          toastIcon.textContent = 'error';
          toastIconWrapper.className = 'w-10 h-10 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0';
          toastIcon.className = 'material-symbols-outlined text-red-600';
        } else {
          toastIcon.textContent = 'check_circle';
          toastIconWrapper.className = 'w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0';
          toastIcon.className = 'material-symbols-outlined text-emerald-600';
        }
        
        toast.classList.remove('translate-x-[120%]');
        toast.classList.add('translate-x-0');
        
        setTimeout(() => {
          toast.classList.remove('translate-x-0');
          toast.classList.add('translate-x-[120%]');
        }, 4000);
      };

      // Loading overlay functions
      window.showLoading = function() {
        document.getElementById('loading-overlay').classList.remove('hidden');
        document.getElementById('loading-overlay').classList.add('flex');
      };

      window.hideLoading = function() {
        document.getElementById('loading-overlay').classList.add('hidden');
        document.getElementById('loading-overlay').classList.remove('flex');
      };
    </script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/nurse.js?v=6"></script>
  </body>
</html>
